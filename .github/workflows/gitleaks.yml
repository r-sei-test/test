name: gitleaks

on:
  pull_request:
  push:
  schedule:
    - cron: "0 4 * * *"   # daily at 04:00 UTC
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref || github.run_id }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  scan:
    name: Gitleaks scan â†’ SARIF
    runs-on: ubuntu-24.04
    timeout-minutes: 20
    permissions:
      contents: read
      security-events: write
      actions: read

    # Use **relative** paths on the host. Inside the container they resolve under /github/workspace.
    env:
      REPORT_DIR: reports
      REPORT_FILE: gitleaks.sarif
      REPORT_PATH: reports/gitleaks.sarif

    steps:
      - name: Harden runner (egress audit)
        uses: step-security/harden-runner@ec9f2d5744a09debf3a187a3f4f675c53b671911 # v2.13.0
        with:
          egress-policy: audi
